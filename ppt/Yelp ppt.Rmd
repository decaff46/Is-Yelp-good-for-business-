---
title: "Yelp Helps?"
author: "team XKL"
date: "April 25, 2019"
output: ioslides_presentation
runtime: shiny
---

```{r setup, include=FALSE}
library(flexdashboard)
library(shiny)
library(rmarkdown)
library(knitr)
library(Hmisc)
library(DT)
library(tidyverse)
library(scales)
library(arules)
library(ggplot2)
library(gridExtra)
library(data.table)
library(base)

library(data.table)
assignInNamespace("cedta.override", value = c(data.table:::cedta.override,"rmarkdown"), ns = "data.table")


opts_chunk$set(echo = FALSE, comment="", warning = FALSE, message = FALSE, tidy.opts=list(width.cutoff=55), tidy = TRUE)
```

```{r read_data, include=FALSE, eval = TRUE}

business <- fread(input = "c:/Users/caffr/OneDrive/Documents/Applied Data Science/Final Proj/Data/yelp_business.csv", verbose = FALSE)
user <- fread(input = "c:/Users/caffr/OneDrive/Documents/Applied Data Science/Final Proj/Data/yelp_user.csv", verbose = FALSE)
restaurant <- fread(input = "c:/Users/caffr/OneDrive/Documents/Applied Data Science/Final Proj/Data/Yelp_restaurant.csv")

```

```{r constants}
business.id.name = "business_id"
business.name.name = "name"
address.name= "address"
city.name = "city"
state.name = "state"
zipcode.name = "postal_code"
latitude.name = "latitude"
longitude.name = "longitude"
stars.name = "stars"
review.coutn.name = "review_count"
category.name = "categories"
is.open.name = "is_open"
cuisine.name = "cuisine.info"


pattern.attributes <- "Attributes_"
attributes.list <- names(business)[grep(pattern = pattern.attributes, x = names(business))]

unique.id <- business[, unique(get(business.id.name))]
unique.name <- business[, unique(get(business.name.name))]
unique.address <- business[, unique(get(address.name))]
unique.city <- business[, unique(get(city.name))]
unique.state <- business[, unique(get(state.name))]
unique.zipcod <- business[, unique(get(zipcode.name))]
unique.cuisine <- restaurant[, unique(get(cuisine.name))]
unique.restaurant <- restaurant[, unique(get(business.id.name))]

num.business <- length(unique.id)
num.restaurant <- length(unique.restaurant)
num.cuisine <- length(unique.cuisine)

respondent.variables1 <- c(city.name, state.name, cuisine.name, review.coutn.name, stars.name)
respondent.variables2 <- c(stars.name)
dependent.variables <- c(is.open.name)
```

```{r functions}
percentage.table <- function(x, digits = 1){
  tab <- table(x)
  number.tab <- 100*tab/(sum(tab))
  rounded.tab <- round(x = percentage.tab, digits = digits)
  return(rounded.tab)
}

round.numerics <- function(x, digits){
  if(is.numeric(x)){
    x <- round(x = x, digits = digits)
  }
  return(x)
}

```
## Introduction

  Yelp data contains `r num.business` of unique business with `r num.restaurant` of unique restaurant information. We categorized the restaurants by their cuisines, and there are `r num.cuisine` different number of cuisines.  


## Does Yelp helps a local business *Sustainability*?

  It is often said that making ourselves *Visible* online is a key factor of success. Yet, according to the actual users, it is not helpful at all.
![](C:/Users/caffr/OneDrive/Documents/Applied Data Science/Final Proj/ppt/bad_review.png)


## City, State, Stars, Cuisine, Review_count

```{r Business}
inputPanel(
  selectInput(inputId="respondent_variable", label = "Select Variable:", choices = respondent.variables1, selected = respondent.variables1[1]),
  
  sliderInput(inputId="respondent_number", label = "Select Digits:", min = 1, max = 10, value = 5, step = 1),
  
  checkboxInput(inputId = "show_number", label = "Show Number", value = TRUE)
)

## check box 
renderPlot({
  tab <- restaurant[, .N, by = eval(input$respondent_variable)]
  setorderv(tab, cols = "N", order = -1)
  
  tab_n = tab[1 :input$respondent_number,]
  
  ggplot(tab_n, aes(x = get(input$respondent_variable), y = N, fill = get(input$respondent_variable))) +
  geom_bar(stat = 'identity', color = "black") +
  theme(legend.position = "none") +
  labs(x = eval(input$respondent_variable), 
       y = 'Count', 
       title = sprintf('Top %d %s in Yelp', input$respondent_num_variable, input$respondent_variable)) +
    if(input$show_number == T){
      geom_text(aes(label = sprintf("%d", N)), vjust = -0.3, size = 4) 
    }

})

```

## Bullets

- Bullet 1
- Bullet 2
- Bullet 3

## R Output

```{r cars}
summary(cars)
```


